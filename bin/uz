#!/usr/bin/env node

var fis = require('fis');
var path = require('path');
var lib = require('linco.lab').lib;
var uzconfig = 'uzconfig.js';
var dirname = process.cwd();
var src, argv = process.argv;

function findconfig(filename){

	// 查找uzconfig.js
	while(dirname !== path.dirname(dirname)){

		// 尝试当前路径下查找
		src = path.join(dirname, filename);
		if(lib.isFile(src)){
			break;
		} else {
			src = null
		}

		// 查找上一级
		dirname = path.dirname(dirname);

		// 尝试查找根目录
		if(dirname === path.dirname(dirname)){
			src = path.join(dirname, filename);
			if(lib.isFile(src)){
				break;
			} else {
				src = null
			}
		}
	}

	return src;
}

// 查找uzconfig.js 
src = findconfig(uzconfig);

// 检查uzconfig.js
if(argv[2] === 'release' && src){

	// 指定uzconfig.js为配置文件
	argv.push('-f');
	argv.push(src);
}

require('../uz.js').cli.run(argv);
